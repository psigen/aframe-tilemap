
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Tilemap Test â€¢ A-Frame</title>
    <meta name="description" content="A-Frame - Tile Render Test">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"
            integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
            crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/aframe/0.7.1/aframe.js"></script>
    <script src="aframe-tilemap.js"></script>
  </head>
  <body>
    <script id="vertexShader" type="x-shader/x-vertex">
      precision highp float;

      uniform mat4 modelViewMatrix;
      uniform mat4 projectionMatrix;

      attribute vec3 position;
      attribute vec3 tilemapOffset;
      attribute vec4 tilemapOrientation;
      attribute vec2 uv;

      varying vec2 vUv;

      void main() {
        vec3 vPosition = position;
        vec3 vcV = cross( tilemapOrientation.xyz, vPosition );
        vPosition = vcV * ( 2.0 * tilemapOrientation.w ) + ( cross( tilemapOrientation.xyz, vcV ) * 2.0 + vPosition );
        vUv = uv;
        gl_Position = projectionMatrix * modelViewMatrix * vec4( tilemapOffset + vPosition, 1.0 );
      }
    </script>
    <script id="fragmentShader" type="x-shader/x-fragment">
      precision highp float;
      uniform sampler2D map;
      varying vec2 vUv;

      void main() {
        gl_FragColor = texture2D( map, vUv );
      }
    </script>
    <a-scene stats vr-mode-ui="enabled: false">
      <a-assets>
        <a-asset-item id="milkTruck" src="https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/CesiumMilkTruck/glTF-Embedded/CesiumMilkTruck.gltf"></a-asset-item>
        <img id="tilemap-image" src="tilemap-128px.png">
      </a-assets>

      <a-entity instanced-tilemap="src: #tilemap-image" position="0 0 -20">
        <a-entity tile="id: 1" geometry="primitive: box; buffer: false" visible="false" scale="1 1 3"></a-entity>
        <!--<a-entity tile="id: 2" geometry="primitive: cylinder; buffer: false" visible="false" position="0 0 1"></a-entity> -->
        <a-entity tile="id: 2; isLoaded: true" gltf-model="#milkTruck" scale="0.5 0.5 0.5"></a-entity>
        <a-entity tile="id: 3" geometry="primitive: sphere; buffer: false" visible="false"></a-entity>
      </a-entity>
      <a-sky color="#ECECEC"></a-sky>
    </a-scene>
  </body>
</html>
